<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Add Event - Developer Tools</title>
  <link rel="stylesheet" href="dev-style.css" />
  <style>
    /* Calendar styles */
    #calendar {
      max-width: 700px;
      margin: 30px auto;
      background: #4e342e;
      color: #fff3e0;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    #calendar header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    #calendar button {
      background: #6d4c41;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      color: #fff3e0;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    #calendar button:hover {
      background: #8d6e63;
    }
    #calendar .weekdays, #calendar .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
    }
    #calendar .weekdays div {
      font-weight: bold;
      padding-bottom: 8px;
      border-bottom: 1px solid #a1887f;
    }
    #calendar .days div {
      padding: 12px;
      border-radius: 6px;
      cursor: default;
      position: relative;
      min-height: 80px;
    }
    #calendar .days div.today {
      background: #cc0000;
      color: white;
      font-weight: bold;
    }
    #calendar .days div.event-day {
      background: #a1887f;
      color: #3e2723;
      cursor: pointer;
    }
    #calendar .event {
      background: #cc0000;
      color: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.8rem;
      margin-top: 5px;
      cursor: pointer;
      word-break: break-word;
    }
    /* Back button style */
    .back-btn {
      display: inline-block;
      background-color: #6d4c41;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      text-align: center;
      margin-top: 15px;
      width: 100%;
      box-sizing: border-box;
    }
    .back-btn:hover {
      background-color: #8d6e63;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <h1>Event Calendar</h1>
    <div id="calendar">
      <header>
        <button id="prevMonth">Prev</button>
        <h2 id="monthYear"></h2>
        <button id="nextMonth">Next</button>
      </header>

      <div class="weekdays">
        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
      </div>
      <div class="days"></div>
    </div>

    <!-- Create and Back Buttons -->
    <div style="text-align:center; margin-top: 25px;">
      <a href="create-event.html" class="logout-btn" style="background:#cc0000; padding: 12px 24px; font-weight:700; border-radius:8px; color:#fff; text-decoration:none; display:inline-block; width:100%; box-sizing:border-box;">Create New Event</a>
      <a href="developer-tools.html" class="back-btn">â¬… Back to Developer Tools</a>
    </div>

    <!-- Edit Event Modal -->
    <div id="editEventModal" style="display:none; position:fixed; top:0; left:0; 
      width:100%; height:100%; background: rgba(0,0,0,0.6); justify-content:center; align-items:center;">
      <div style="background:#4e342e; color:#fff3e0; padding:25px; border-radius:12px; max-width:400px; width:90%;">
        <h3>Edit Event</h3>
        <form id="editEventForm">
          <input type="hidden" id="editEventIndex" />
          <label>Title:</label>
          <input type="text" id="editEventTitle" required style="width:100%; padding:8px; margin-bottom:10px; border-radius:6px; border:none;" />
          <label>Date:</label>
          <input type="date" id="editEventDate" required min="2023-01-01" max="2026-12-31" style="width:100%; padding:8px; margin-bottom:10px; border-radius:6px; border:none;" />
          <label>Time:</label>
          <input type="time" id="editEventTime" required style="width:100%; padding:8px; margin-bottom:10px; border-radius:6px; border:none;" />
          <label>Location:</label>
          <input type="text" id="editEventLocation" required style="width:100%; padding:8px; margin-bottom:15px; border-radius:6px; border:none;" />
          <div style="text-align:right;">
            <button type="button" id="deleteEventBtn" style="background:#cc0000; color:#fff; border:none; padding:8px 12px; margin-right:10px; border-radius:6px; cursor:pointer;">Delete</button>
            <button type="submit" style="background:#a1887f; color:#3e2723; border:none; padding:8px 12px; border-radius:6px; cursor:pointer;">Save</button>
            <button type="button" id="closeModalBtn" style="background:#555; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; margin-left:10px;">Cancel</button>
          </div>
        </form>
      </div>
    </div>

  </div>

<script>
  const calendar = document.getElementById('calendar');
  const monthYear = document.getElementById('monthYear');
  const daysContainer = calendar.querySelector('.days');
  const prevBtn = document.getElementById('prevMonth');
  const nextBtn = document.getElementById('nextMonth');

  let currentDate = new Date();

  function loadEvents() {
    return JSON.parse(localStorage.getItem('events')) || [];
  }

  function saveEvents(events) {
    localStorage.setItem('events', JSON.stringify(events));
  }

  function renderCalendar(date) {
    daysContainer.innerHTML = '';
    monthYear.textContent = date.toLocaleString('default', { month: 'long', year: 'numeric' });

    const year = date.getFullYear();
    const month = date.getMonth();

    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);

    const startDayIndex = firstDay.getDay();
    const totalDays = lastDay.getDate();

    for(let i = 0; i < startDayIndex; i++) {
      const emptyDiv = document.createElement('div');
      daysContainer.appendChild(emptyDiv);
    }

    const events = loadEvents();

    for(let day = 1; day <= totalDays; day++) {
      const dayEl = document.createElement('div');
      const fullDate = `${year}-${String(month + 1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      dayEl.textContent = day;

      const today = new Date();
      if(day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
        dayEl.classList.add('today');
      }

      const eventsOnDay = events.filter(ev => ev.date === fullDate);
      if(eventsOnDay.length) {
        dayEl.classList.add('event-day');

        eventsOnDay.forEach(event => {
          const eventDiv = document.createElement('div');
          eventDiv.classList.add('event');
          eventDiv.title = `Time: ${event.time}\nLocation: ${event.location}`;
          eventDiv.innerHTML = `<strong>${event.title}</strong><br>${event.time}<br><small>${event.location}</small>`;
          eventDiv.addEventListener('click', () => openEditEventModal(event));
          dayEl.appendChild(eventDiv);
        });
      }

      daysContainer.appendChild(dayEl);
    }
  }

  const editModal = document.getElementById('editEventModal');
  const editForm = document.getElementById('editEventForm');
  const deleteBtn = document.getElementById('deleteEventBtn');
  const closeModalBtn = document.getElementById('closeModalBtn');

  function openEditEventModal(event) {
    editModal.style.display = 'flex';
    const events = loadEvents();
    const index = events.findIndex(ev => ev.title === event.title && ev.date === event.date && ev.time === event.time && ev.location === event.location);
    if(index === -1) return alert('Event not found.');
    document.getElementById('editEventIndex').value = index;
    document.getElementById('editEventTitle').value = events[index].title;
    document.getElementById('editEventDate').value = events[index].date;
    document.getElementById('editEventTime').value = events[index].time || '';
    document.getElementById('editEventLocation').value = events[index].location || '';
  }

  closeModalBtn.onclick = () => {
    editModal.style.display = 'none';
  };

  window.onclick = (e) => {
    if (e.target === editModal) {
      editModal.style.display = 'none';
    }
  };

  editForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const index = document.getElementById('editEventIndex').value;
    const title = document.getElementById('editEventTitle').value.trim();
    const date = document.getElementById('editEventDate').value;
    const time = document.getElementById('editEventTime').value;
    const location = document.getElementById('editEventLocation').value.trim();

    if(!title || !date || !time || !location) {
      alert('Please fill all fields.');
      return;
    }

    let events = loadEvents();
    events[index] = { title, date, time, location };
    saveEvents(events);

    alert('Event updated successfully!');
    editModal.style.display = 'none';
    renderCalendar(currentDate);
  });

  deleteBtn.addEventListener('click', () => {
    if(!confirm('Are you sure you want to delete this event?')) return;
    const index = document.getElementById('editEventIndex').value;
    let events = loadEvents();
    events.splice(index, 1);
    saveEvents(events);

    alert('Event deleted.');
    editModal.style.display = 'none';
    renderCalendar(currentDate);
  });

  prevBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar(currentDate);
  });

  nextBtn.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar(currentDate);
  });

  renderCalendar(currentDate);
</script>
</body>
</html>